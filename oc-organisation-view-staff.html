<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../oc-view-staff/oc-view-staff.html">
<link rel="import" href="../oc-authorization-api/oc-authorization-api.html">
<link rel="import" href="../oc-user-api/oc-user-api.html">

<!--
`oc-organisation-view-staff`
Element to manage staff list view on the Ordercloud platform

@demo demo/index.html
-->

<dom-module id="oc-organisation-view-staff">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <oc-authorization-api id="authApi"></oc-authorization-api>
    <oc-user-api id="userApi"></oc-user-api>

    <oc-view-staff items="[[_userList]]" total-items="[[_totalItems]]" page-size="[[_pageSize]]"></oc-view-staff>

  </template>

  <script>
    Polymer({

      is: 'oc-organisation-view-staff',

      properties: {
        organisationId: Number,
        loading: {
          type: Boolean,
          notify: true
        },
        _userList : Array
      },

      listeners: {
        "reset" : "_resendInvite",
        "delete" : "_rejectInvite"
      },

      refresh : function(){
        this._getUsers(this.organisationId)
      },

      _getUsers : function(organisationId){
        this.$.authApi.getOrganisationMembers(organisationId)
                .then(function(request){
                  this._userList = request.response.results;
                  this._pageSize = request.response.results.length;
                  this._totalItems = request.response.count;
                }.bind(this))
                .catch(this.fire.bind(this, 'options_error', 'Could not create option set'))
                .finally(this.set.bind(this, 'loading', false));
      },

      _resetPassword : function(e){
        this.loading = true;
//        this.$.inviteApi.resendInvite(e.detail.id)
//                .catch(this.fire.bind(this, 'options_error', 'Could not create option set'))
//                .finally(this.set.bind(this, 'loading', false));
      },

      _deleteUser : function(e){
        this.loading = true;
//        this.$.inviteApi.rejectInvite(e.detail.hash)
//                .catch(this.fire.bind(this, 'options_error', 'Could not create option set'))
//                .finally(this.set.bind(this, 'loading', false));
      }

    });
  </script>
</dom-module>
